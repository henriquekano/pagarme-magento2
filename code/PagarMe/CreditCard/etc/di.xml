<?xml version="1.0"?>
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">

  <virtualType name="PagarMeCreditCardAuthorizationHandler" type="Magento\Payment\Gateway\Response\HandlerChain">
    <arguments>
      <argument name="handlers" xsi:type="array">
        <item name="payment_details" xsi:type="string">PagarMe\CreditCard\Gateway\Response\CreditCardDetailsHandler</item>
      </argument>
    </arguments>
  </virtualType>

  <!-- Handles the frontend form data. -->
  <virtualType name="PagarMeCreditCardAuthorizeRequest" type="Magento\Payment\Gateway\Request\BuilderComposite">
    <arguments>
      <argument name="builders" xsi:type="array">
        <item name="payment" xsi:type="string">PagarMe\CreditCard\Gateway\Request\PaymentDataBuilder</item>
      </argument>
    </arguments>
  </virtualType>

  <!-- The higher-level class that deals with authorize "commands" (gets the request, calls APIs, validates stuff). -->
  <virtualType name="PagarMeCreditCardCaptureCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
    <arguments>
      <argument name="requestBuilder" xsi:type="object">PagarMeCreditCardAuthorizeRequest</argument>
      <argument name="transferFactory" xsi:type="object">PagarMe\CreditCard\Gateway\Http\TransferFactory</argument>
      <argument name="client" xsi:type="object">PagarMe\CreditCard\Gateway\Http\Client\TransactionSale</argument>
      <argument name="handler" xsi:type="object">PagarMeCreditCardAuthorizationHandler</argument>
      <argument name="validator" xsi:type="object">PagarMe\CreditCard\Gateway\Validator\ResponseValidator</argument>
    </arguments>
  </virtualType>
  <virtualType name="PagarMeCreditCardAuthorizeCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
    <arguments>
      <argument name="requestBuilder" xsi:type="object">PagarMeCreditCardAuthorizeRequest</argument>
      <argument name="transferFactory" xsi:type="object">PagarMe\CreditCard\Gateway\Http\TransferFactory</argument>
      <argument name="client" xsi:type="object">PagarMe\CreditCard\Gateway\Http\Client\TransactionSale</argument>
      <argument name="handler" xsi:type="object">PagarMeCreditCardAuthorizationHandler</argument>
      <argument name="validator" xsi:type="object">PagarMe\CreditCard\Gateway\Validator\ResponseValidator</argument>
    </arguments>
  </virtualType>

  <!-- Collection of commands available -->
  <virtualType name="PagarMeCreditCardCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
    <arguments>
      <argument name="commands" xsi:type="array">
        <item name="authorize" xsi:type="string">PagarMeCreditCardAuthorizeCommand</item>
        <item name="capture" xsi:type="string">PagarMeCreditCardCaptureCommand</item>
      </argument>
    </arguments>
  </virtualType>


  <!-- Checks whether the method should be enabled given the store configs, situations, etc -->
  <virtualType name="PagarMeCreditCardValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
    <arguments>
        <argument name="validators" xsi:type="array">
        </argument>
    </arguments>
  </virtualType>
  <virtualType name="PagarMeCreditCardGatewayConfig" type="Magento\Payment\Gateway\Config\Config">
    <arguments>
        <argument name="methodCode" xsi:type="const">PagarMe\CreditCard\Model\Ui\ConfigProvider::CODE</argument>
    </arguments>
  </virtualType>
  <virtualType name="PagarMeCreditCardConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
    <arguments>
        <argument name="configInterface" xsi:type="object">PagarMeCreditCardGatewayConfig</argument>
    </arguments>
  </virtualType>

  <!-- From what I understand, if any confg in etc/config.xml has any condition, you can specify a value handler -->
  <virtualType name="PagarMeCreditCardValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
    <arguments>
        <argument name="handlers" xsi:type="array">
            <item name="default" xsi:type="string">PagarMeCreditCardConfigValueHandler</item>
        </argument>
    </arguments>
  </virtualType>
  <virtualType name="PagarMeCreditCardFacade" type="Magento\Payment\Model\Method\Adapter">
    <arguments>
        <argument name="code" xsi:type="const">PagarMe\CreditCard\Model\Ui\ConfigProvider::CODE</argument>
        <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
        <argument name="infoBlockType" xsi:type="string">Magento\Payment\Block\ConfigurableInfo</argument>
        <argument name="valueHandlerPool" xsi:type="object">PagarMeCreditCardValueHandlerPool</argument>
        <argument name="validatorPool" xsi:type="object">PagarMeCreditCardValidatorPool</argument>
        <argument name="commandPool" xsi:type="object">PagarMeCreditCardCommandPool</argument>
    </arguments>
  </virtualType>


</config>
